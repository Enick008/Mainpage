<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Prompt', sans-serif; }
  </style>
</head>
<body class="bg-blue-50 min-h-screen">
  <div class="max-w-xl mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4 text-center text-blue-800">üì¢ ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h1>
    <div class="bg-white rounded-xl shadow-md p-4 mb-4">
      <textarea id="announceInput" class="w-full border rounded-lg p-2 mb-2" rows="3" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®..."></textarea>
      <button onclick="addAnnouncement()"
        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg w-full font-semibold transition">
        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
      </button>
    </div>
    <div id="announceList" class="space-y-3"></div>
  </div>
  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbyUBo00IJyYOd8jNiL-IMnYU6nB-4zvRHoPNBz4aRVNAILG8BM6v-8N4N9ck7hELAhuyg/exec';
    let announcements = [];
    async function fetchAnnouncements() {
      try {
        const res = await fetch(`${API_URL}?action=get`);
        const json = await res.json();
        if (json.success) {
          announcements = json.data;
          renderAnnouncements();
        }
      } catch (e) {
        document.getElementById('announceList').innerHTML = '<div class="text-red-600 text-center">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</div>';
      }
    }
    async function addAnnouncement() {
      const input = document.getElementById('announceInput');
      const text = input.value.trim();
      if (!text) return;
      const res = await fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'add', message: text }),
        headers: { 'Content-Type': 'application/json' }
      });
      const json = await res.json();
      if (json.success) {
        input.value = '';
        fetchAnnouncements();
      }
    }
    async function deleteAnnouncement(idx) {
      const item = announcements[idx];
      if (!item) return;
      if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡πâ?')) return;
      const res = await fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'delete', id: item.id }),
        headers: { 'Content-Type': 'application/json' }
      });
      const json = await res.json();
      if (json.success) fetchAnnouncements();
    }
    function renderAnnouncements() {
      const list = document.getElementById('announceList');
      list.innerHTML = announcements.length === 0
        ? '<p class="text-gray-400 text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</p>'
        : announcements.map((a, i) => `
          <div class="bg-white border-l-4 border-blue-500 shadow p-3 rounded-xl relative group">
            <div class="text-gray-800 mb-1">${a.message.replace(/\n/g,'<br>')}</div>
            <div class="text-xs text-gray-400">${a.timestamp}</div>
            <button onclick="deleteAnnouncement(${i})"
              class="absolute top-2 right-2 text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition"
              title="‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®">‚úñ</button>
          </div>
        `).join('');
    }
    fetchAnnouncements();
  </script>
</body>
</html>
